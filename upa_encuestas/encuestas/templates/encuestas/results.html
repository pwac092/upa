<!DOCTYPE HTML>
<!--
	Hyperspace by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
{% load staticfiles %}
<html>
	<head>
		<title>Encuestas UPA</title>
		<meta charset="utf-8" />
        <!--[if lte IE9] <link rel="stylesheet" href="{% static "encuestas/assets/css/ie9.css" %}" />![endif]-->
        <!--[if lte IE9] <link rel="stylesheet" href="{% static "encuestas/assets/css/ie8.css" %}" />![endif]-->
        <!--[if lte IE9] <link rel="stylesheet" href="{% static "encuestas/assets/js/ie/html5shiv.js" %}" />![endif]-->

		<meta name="viewport" content="width=device-width, initial-scale=1" />

        <link rel="stylesheet" href="{% static "encuestas/assets/css/main.css" %}" />
        <link rel="stylesheet" href="{% static "encuestas/assets/css/jquery-ui.css" %}">
        <link rel="stylesheet" href="{% static "encuestas/assets/css/style.css" %}">

	</head>
    
	<body>

		<!-- Sidebar -->
			<section id="sidebar">
				<div class="inner">
					<nav>
						<ul>
                            <!--<li><a href="#agregar">Agregar evaluaci&oacute;n</a></li>-->
							<li><a href="#resumen">Resumen</a></li>
							<li><a href="#detalle">Detalle</a></li>
                            <!--<li><a href="#alumnos">Alumnos</a></li>-->
						</ul>
					</nav>
				</div>
			</section>

		<!-- Wrapper -->
			<div id="wrapper">
				<!-- Intro -->
					<!--<section id="agregar" class="wrapper style1 fullscreen fade-up">
						<div class="inner">
							<h1>Agregar nueva evaluaci&oacute;n</h1>
							<ul class="actions">
                                {% for i in clases %}
                                    <li><a href="/encuestas/lista_clase/{{i.1}}" class="button scrolly">{{i.0}}</a></li>
                                {% endfor %}
							</ul>
						</div>
                        </section>-->

				<!-- Intro -->
					<section id="resumen" class="wrapper style1 fullscreen fade-up">
						<div class="inner">
							<h1>Resumen</h1>
							<ul class="actions">
                                {{composite_score}}
                                {{student_score}}
                                {% for i in comments%}
                                    {{i}} <br>
                                {%endfor%}
							</ul>
						</div>
					</section>

				<!-- One -->
					<section id="detalle" class="wrapper style1 fullscreen fade-up">
						<div class="inner">
							<h1>Detalle</h1>
                            <div id="detalle"></div>
                        </div>
					</section>

				<!-- Two 
					<section id="alumnos" class="wrapper style3 fade-up">
						<div class="inner">
							</div>
						</div>
                        </section>-->
			</div>

		<!-- Footer -->
			<footer id="footer" class="wrapper style1-alt">
				<div class="inner">
					<ul class="menu">
						<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
				</div>
			</footer>

		<!-- Scripts -->
        <script src="{%static "encuestas/assets/js/jquery.min.js" %}"></script>
        <script src="{%static "encuestas/assets/js/jquery.scrollex.min.js" %}"></script>
        <script src="{%static "encuestas/assets/js/jquery.scrolly.min.js" %}"></script>
        <script src="{%static "encuestas/assets/js/skel.min.js" %}"></script>
        <script src="{%static "encuestas/assets/js/util.js" %}"></script>
        <script src="{%static "encuestas/assets/js/main.js" %}"></script>
        <script src="{% static "encuestas/assets/js/jquery-ui.js" %}"></script>
        <!--[if lte IE 8]><script src="{% static "encuestas/assets/js/ie/respond.min.js" %}"></script><![endif]-->
        <script src="http://d3js.org/d3.v3.min.js"></script>

        <script>

function breaklines(str, n) {
    var lines = str.split(/\s+/), // explode on whitespaces
        n = +n || 50;
    var res = [];
    for (var i=0; i<lines.length; ) {
        for (var l = 0, line = []; l + lines[i].length <= n; i++) {
            l += 1 + lines[i].length;
            line.push(lines[i]);
        }
        res.push(line.join(" "));
    }
    return res.join("<br>");
}


var createHistogram = function(data, maxBin, binInc, title) {


  // A formatter for counts.

  var formatCount = d3.format(",.0f");

  var totalWidth = 1080;

  var totalHeight = 240;

  var margin = {top: 40, right: 60, bottom: 50, left: 70},

      width = totalWidth - margin.left - margin.right,

      height = totalHeight - margin.top - margin.bottom;

  

  var binArray = [];

  for (var i = 0; i <= maxBin + binInc; i += binInc) {

    binArray.push(i);

  }

  var binTicks = [];

  for (var i = 0; i < maxBin + binInc; i += binInc) {

    binTicks.push(i);

  }

  

  var x = d3.scale.linear()

      .domain([0, maxBin + binInc])

      .range([0, width]);

  var binWidth = parseFloat(width / (binArray.length - 1)) - 1 - 150;

  

  var y = d3.scale.linear()

      .domain([0, d3.max(data, function(d) { return d.y; })])

      .range([height, 0]);

  

  var xAxis = d3.svg.axis()

      .scale(x)

      .orient("bottom")

      .tickValues(binTicks);

      

  var yAxis = d3.svg.axis()

      .scale(y)

      .orient("left");

  

  var svg = d3.select("#detalle").append("svg")

      .attr("width", width + margin.left + margin.right)

      .attr("height", height + margin.top + margin.bottom)

      .append("g")

      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  

  var bar = svg.selectAll(".bar")

      .data(data)

      .enter()

      .append("rect")

      .attr("class", "bar")

      .attr("x", function(d) { return x(d.x); })

      .attr("width", binWidth)

      .attr("y", function(d) { return y(d.y); })

      .attr("height", function(d) { return height - y(d.y); })

      .on("mouseover", function(d) {

        var barWidth = parseFloat(d3.select(this).attr("width"));

        var xPosition = parseFloat(d3.select(this).attr("x")) + (barWidth / 2);

        var yPosition = parseFloat(d3.select(this).attr("y")) - 10;

        

        svg.append("text")

          .attr("id", "tooltip")

          .attr("x", xPosition)

          .attr("y", yPosition)

          .attr("text-anchor", "middle")

          .text(d.y);

      })

      .on("mouseout", function(d) {

        d3.select('#tooltip').remove();

      });

  

  svg.append("g")

      .attr("class", "x axis")

      .attr("transform", "translate(0," + height + ")")

      .call(xAxis);

      

  svg.append("g")

      .attr("class", "y axis")

      //.attr("transform", "translate(0," + height + ")")

      .call(yAxis);

      

  // Add axis labels

  svg.append("text")

      .attr("class", "x label")

      .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom - 15) + ")")

      //.attr("dy", "1em")

      .attr("text-anchor", "middle")

      .text("Score ");

      

  svg.append("text")

      .attr("class", "y label")

      .attr("transform", "rotate(-90)")

      .attr("y", 0 - margin.left)

      .attr("x", 0 - (height / 2))

      .attr("dy", "1em")

      .attr("text-anchor", "middle")

      .text("Count");

      

  // Add title to chart

  svg.append("text")

      .attr("class", "title")

      .attr("transform", "translate(" + (width - width) + " ," + (-10) + ")")

      //.attr("dy", "1em")

      .attr("text-anchor", "right")

      .text(title);  

};

$( document ).ready(function() {

    var json = {{ json|safe }};

//    d3.json(json_data, function(json) {
      

      var maxBin = 4;

      var binInc = 1;

      for( var i = 0; i < json.length; i++) {

        // use the name of the group to initialize the array

        var group = json[i].name;

        var data = [];

        

        // we have a max bin for our histogram, must ensure

        // that any bins > maximum bin are rolled into the 

        // last bin that we have

        var binCounts = {};

        for( var j = 0; j < json[i].data.length; j++) {

          var xValue = json[i].data[j].bin;

          // bin cannot exceed the maximum bin

          xValue = ( xValue > maxBin ? maxBin : xValue);

          var yValue = json[i].data[j].count;

          

          if(binCounts[xValue] === undefined) {

            binCounts[xValue] = 0;

          }

          binCounts[xValue] += yValue;

        }

        

        // add the bin counts in

        for( var bin in binCounts) {

          data.push({"x": bin, "y": binCounts[bin]});

        }

        

        // add the histogram
        //var line = breaklines(group.toUpperCase(),10)
        var line = group.toUpperCase();


        createHistogram(data, maxBin, binInc,line) 

      }

});


    </script>


  </body>


</html>
